--== CONFIG ==--
local TARGET_CFRAME = CFrame.new(87, 3, 0)
local DEFAULT_INTERVAL = 300 -- วินาที

--== SERVICES ==--
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- ถ้ามีอยู่แล้วให้ลบทิ้งก่อน (กันซ้ำเวลาเทส)
local old = PlayerGui:FindFirstChild("AutoSellUI")
if old then old:Destroy() end

local GameEvents = ReplicatedStorage:WaitForChild("GameEvents")
local SellEvent = GameEvents:WaitForChild("Sell_Inventory")

--== ฟังก์ชันขาย ==--
local function tpSellAndReturn()
	local char = player.Character or player.CharacterAdded:Wait()
	local root = char:WaitForChild("HumanoidRootPart")
	local humanoid = char:WaitForChild("Humanoid")

	local originalCFrame = root.CFrame
	local oldWalk, oldJump = humanoid.WalkSpeed, humanoid.JumpPower
	humanoid.WalkSpeed, humanoid.JumpPower = 0, 0

	char:PivotTo(TARGET_CFRAME)
	task.wait(0.15)
	SellEvent:FireServer()
	task.wait(0.3)
	char:PivotTo(originalCFrame)

	humanoid.WalkSpeed, humanoid.JumpPower = oldWalk, oldJump
end

--== ฟังก์ชันลาก ==--
local function dragify(handle, target)
	local dragging, dragInput, startPos, startInputPos
	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			startPos = target.Position
			startInputPos = input.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)

	handle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - startInputPos
			target.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

--== GUI หลัก ==--
local gui = Instance.new("ScreenGui")
gui.Name = "AutoSellUI"
gui.ResetOnSpawn = false
gui.Parent = PlayerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 260, 0, 210)
frame.Position = UDim2.new(0.05, 0, 0.25, 0)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
frame.BackgroundTransparency = 0.1
frame.BorderSizePixel = 0
frame.Active = true
frame.Parent = gui

-- มุมโค้งมน
local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 12)
frameCorner.Parent = frame

-- เส้นขอบ
local frameStroke = Instance.new("UIStroke")
frameStroke.Color = Color3.fromRGB(60, 60, 70)
frameStroke.Thickness = 1.5
frameStroke.Transparency = 0.3
frameStroke.Parent = frame

-- Header bar
local header = Instance.new("Frame", frame)
header.Size = UDim2.new(1, 0, 0, 35)
header.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
header.BorderSizePixel = 0
header.Active = true
header.Draggable = false -- ใช้ dragify แทน

-- Header corner (top only)
local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 12)
headerCorner.Parent = header

-- Header gradient effect
local headerGradient = Instance.new("UIGradient")
headerGradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 50, 70)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 40))
})
headerGradient.Rotation = 45
headerGradient.Parent = header

local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(1, -70, 1, 0)
title.Position = UDim2.new(0, 12, 0, 0)
title.Text = "⚙️ GAG Dev Summao"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextStrokeTransparency = 0.8
title.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)

-- ปุ่มย่อ
local minimizeBtn = Instance.new("TextButton", header)
minimizeBtn.Size = UDim2.new(0, 28, 0, 28)
minimizeBtn.Position = UDim2.new(1, -62, 0, 3)
minimizeBtn.Text = "–"
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.TextSize = 20
minimizeBtn.BackgroundColor3 = Color3.fromRGB(70, 80, 100)
minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeBtn.BorderSizePixel = 0
minimizeBtn.AutoButtonColor = false

local minCorner = Instance.new("UICorner")
minCorner.CornerRadius = UDim.new(0, 6)
minCorner.Parent = minimizeBtn

-- Hover effect for minimize
minimizeBtn.MouseEnter:Connect(function()
	TweenService:Create(minimizeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(90, 100, 120)}):Play()
end)
minimizeBtn.MouseLeave:Connect(function()
	TweenService:Create(minimizeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 80, 100)}):Play()
end)

-- ปุ่มปิด
local closeBtn = Instance.new("TextButton", header)
closeBtn.Size = UDim2.new(0, 28, 0, 28)
closeBtn.Position = UDim2.new(1, -32, 0, 3)
closeBtn.Text = "×"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 20
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.BorderSizePixel = 0
closeBtn.AutoButtonColor = false

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 6)
closeCorner.Parent = closeBtn

-- Hover effect for close
closeBtn.MouseEnter:Connect(function()
	TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(220, 80, 80)}):Play()
end)
closeBtn.MouseLeave:Connect(function()
	TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(200, 60, 60)}):Play()
end)

--== เนื้อหาภายใน ==--
local toggle = Instance.new("TextButton", frame)
toggle.Size = UDim2.new(0, 220, 0, 36)
toggle.Position = UDim2.new(0, 20, 0, 45)
toggle.BackgroundColor3 = Color3.fromRGB(200, 70, 70)
toggle.Text = "Auto Sell: OFF"
toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
toggle.Font = Enum.Font.GothamBold
toggle.TextSize = 15
toggle.AutoButtonColor = false

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggle

local toggleStroke = Instance.new("UIStroke")
toggleStroke.Color = Color3.fromRGB(100, 100, 100)
toggleStroke.Thickness = 1
toggleStroke.Transparency = 0.5
toggleStroke.Parent = toggle

-- Hover effect
toggle.MouseEnter:Connect(function()
	TweenService:Create(toggle, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(220, 90, 90)}):Play()
end)
toggle.MouseLeave:Connect(function()
	local targetColor = enabled and Color3.fromRGB(70, 200, 70) or Color3.fromRGB(200, 70, 70)
	TweenService:Create(toggle, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
end)

local inputLabel = Instance.new("TextLabel", frame)
inputLabel.Size = UDim2.new(0, 120, 0, 22)
inputLabel.Position = UDim2.new(0, 20, 0, 92)
inputLabel.BackgroundTransparency = 1
inputLabel.Text = "Interval (sec):"
inputLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
inputLabel.Font = Enum.Font.Gotham
inputLabel.TextSize = 13
inputLabel.TextXAlignment = Enum.TextXAlignment.Left

local intervalBox = Instance.new("TextBox", frame)
intervalBox.Size = UDim2.new(0, 90, 0, 28)
intervalBox.Position = UDim2.new(0, 140, 0, 90)
intervalBox.Text = tostring(DEFAULT_INTERVAL)
intervalBox.TextColor3 = Color3.fromRGB(255, 255, 255)
intervalBox.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
intervalBox.ClearTextOnFocus = false
intervalBox.Font = Enum.Font.Gotham
intervalBox.TextSize = 14
intervalBox.PlaceholderText = "300"
intervalBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)

local boxCorner = Instance.new("UICorner")
boxCorner.CornerRadius = UDim.new(0, 6)
boxCorner.Parent = intervalBox

local boxStroke = Instance.new("UIStroke")
boxStroke.Color = Color3.fromRGB(60, 60, 70)
boxStroke.Thickness = 1
boxStroke.Transparency = 0.3
boxStroke.Parent = intervalBox

-- Focus effects
intervalBox.Focused:Connect(function()
	TweenService:Create(intervalBox, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(45, 45, 55)}):Play()
	TweenService:Create(boxStroke, TweenInfo.new(0.2), {Color = Color3.fromRGB(100, 150, 255), Transparency = 0.2}):Play()
end)
intervalBox.FocusLost:Connect(function()
	TweenService:Create(intervalBox, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}):Play()
	TweenService:Create(boxStroke, TweenInfo.new(0.2), {Color = Color3.fromRGB(60, 60, 70), Transparency = 0.3}):Play()
end)

local statusLabel = Instance.new("TextLabel", frame)
statusLabel.Size = UDim2.new(1, -40, 0, 20)
statusLabel.Position = UDim2.new(0, 20, 0, 128)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Status: Idle"
statusLabel.TextColor3 = Color3.fromRGB(180, 200, 255)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 13
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.TextStrokeTransparency = 0.7
statusLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)

-- ปุ่มเปิด/ปิด AFK
local afkToggle = Instance.new("TextButton", frame)
afkToggle.Size = UDim2.new(0, 220, 0, 36)
afkToggle.Position = UDim2.new(0, 20, 0, 158)
afkToggle.BackgroundColor3 = Color3.fromRGB(70, 200, 70)
afkToggle.Text = "AFK: ON"
afkToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
afkToggle.Font = Enum.Font.GothamBold
afkToggle.TextSize = 15
afkToggle.AutoButtonColor = false

local afkCorner = Instance.new("UICorner")
afkCorner.CornerRadius = UDim.new(0, 8)
afkCorner.Parent = afkToggle

local afkStroke = Instance.new("UIStroke")
afkStroke.Color = Color3.fromRGB(100, 100, 100)
afkStroke.Thickness = 1
afkStroke.Transparency = 0.5
afkStroke.Parent = afkToggle

-- Hover effect
afkToggle.MouseEnter:Connect(function()
	TweenService:Create(afkToggle, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(90, 220, 90)}):Play()
end)
afkToggle.MouseLeave:Connect(function()
	local targetColor = afkEnabled and Color3.fromRGB(70, 200, 70) or Color3.fromRGB(200, 70, 70)
	TweenService:Create(afkToggle, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
end)

--== ตัวแปรสถานะ ==--
local enabled = false
local interval = DEFAULT_INTERVAL
local worker
local minimized = false
local debounce = false
local afkEnabled = true -- AFK เปิดอยู่โดย default
local jumpWorker = nil

--== ฟังก์ชัน ==--
local function parseInterval()
	local n = tonumber(intervalBox.Text)
	if not n or n <= 0 then
		intervalBox.Text = tostring(interval)
		return interval
	end
	interval = math.floor(n)
	return interval
end

local function setToggle(on)
	enabled = on
	if on then
		toggle.Text = "Auto Sell: ON"
		TweenService:Create(toggle, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(70, 200, 70)}):Play()
	else
		toggle.Text = "Auto Sell: OFF"
		TweenService:Create(toggle, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(200, 70, 70)}):Play()
	end
end

local function runNowThenSchedule()
	if debounce then return end
	debounce = true
	statusLabel.Text = "Status: Running…"
	tpSellAndReturn()
	statusLabel.Text = ("Status: Waiting %ds"):format(interval)

	if worker then task.cancel(worker) end
	worker = task.spawn(function()
		while enabled do
			local t = interval
			local elapsed = 0
			while enabled and elapsed < t do
				local step = math.min(0.25, t - elapsed)
				task.wait(step)
				elapsed += step
				statusLabel.Text = ("Status: Waiting %ds"):format(math.max(0, math.ceil(t - elapsed)))
			end
			if not enabled then break end
			statusLabel.Text = "Status: Running…"
			tpSellAndReturn()
			statusLabel.Text = ("Status: Waiting %ds"):format(interval)
		end
	end)
	debounce = false
end

--== ฟังก์ชันกระโดด ==--
local function makeCharacterJump()
	local char = player.Character
	if char and char:FindFirstChild("Humanoid") then
		char.Humanoid.Jump = true
	end
end

--== ฟังก์ชันตั้งค่า AFK ==--
local function setAFK(on)
	afkEnabled = on
	if on then
		afkToggle.Text = "AFK: ON"
		TweenService:Create(afkToggle, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(70, 200, 70)}):Play()
		-- หยุดการกระโดด
		if jumpWorker then
			task.cancel(jumpWorker)
			jumpWorker = nil
		end
	else
		afkToggle.Text = "AFK: OFF"
		TweenService:Create(afkToggle, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(200, 70, 70)}):Play()
		-- เริ่มการกระโดดทุก 5 นาที
		if jumpWorker then task.cancel(jumpWorker) end
		jumpWorker = task.spawn(function()
			while not afkEnabled do
				task.wait(300) -- 5 นาที = 300 วินาที
				if not afkEnabled then
					makeCharacterJump()
				end
			end
		end)
	end
end

--== ปุ่มเปิด/ปิด Auto ==--
toggle.MouseButton1Click:Connect(function()
	parseInterval()
	if not enabled then
		setToggle(true)
		runNowThenSchedule()
	else
		setToggle(false)
		statusLabel.Text = "Status: Idle"
		if worker then task.cancel(worker) worker = nil end
	end
end)

intervalBox.FocusLost:Connect(parseInterval)

--== ปุ่มเปิด/ปิด AFK ==--
afkToggle.MouseButton1Click:Connect(function()
	setAFK(not afkEnabled)
end)

--== ปุ่มย่อ ==--
minimizeBtn.MouseButton1Click:Connect(function()
	if minimized then
		TweenService:Create(frame, TweenInfo.new(0.3), {Size = UDim2.new(0, 260, 0, 210)}):Play()
		for _,v in pairs(frame:GetChildren()) do
			if v ~= header then v.Visible = true end
		end
		minimizeBtn.Text = "–"
		minimized = false
	else
		for _,v in pairs(frame:GetChildren()) do
			if v ~= header then v.Visible = false end
		end
		TweenService:Create(frame, TweenInfo.new(0.3), {Size = UDim2.new(0, 260, 0, 35)}):Play()
		minimizeBtn.Text = "+"
		minimized = true
	end
end)

--== ปุ่มปิด ==--
closeBtn.MouseButton1Click:Connect(function()
	if worker then task.cancel(worker) end
	if jumpWorker then task.cancel(jumpWorker) end
	gui:Destroy()
end)

--== เปิดฟังก์ชันลากทั้ง frame ด้วยหัว ==--
dragify(header, frame)